<template>
  <transition name="module" @enter="setStyle" @after-enter="unsetStyle" @before-leave="setStyle">
    <div v-if="showWindow" class="showWindow" :style="windowStyle">
      <div class="top">
        <div class="notice">
          <svg
            t="1592295097203"
            class="icon"
            viewBox="0 0 1024 1024"
            version="1.1"
            xmlns="http://www.w3.org/2000/svg"
            p-id="6256"
            width="32"
            height="32"
          >
            <path
              d="M803.19648 313.005499l-42.542945-73.515848 220.70113-127.475252L1023.89761 185.479052l-220.70113 127.475253z m-165.871413 706.694131a40.955904 40.955904 0 0 1-24.675932-8.856714l-0.511949 0.563143-385.49745-289.09749H0V297.493451h226.537346L611.932407 8.39596c0.10239 0.20478 0.358364 0.307169 0.511949 0.563144A40.955904 40.955904 0 0 1 637.069093 0.10239c23.39606 0 42.491751 18.993301 42.491751 42.491751v934.664933a42.184582 42.184582 0 0 1-42.286971 42.440556z m127.475253-552.290371h254.950505v84.983502h-254.950505v-84.983502z m255.155284 389.490651l-41.263073 77.457854-214.096991-134.232976 41.263074-77.50905 214.09699 134.284172z"
              fill="#ffffff"
              p-id="6257"
            />
          </svg>
          <span>{{title}}</span>
        </div>
        <div class="close" @click="closeWindow">
          <svg
            t="1592294782474"
            class="icon"
            viewBox="0 0 1024 1024"
            version="1.1"
            xmlns="http://www.w3.org/2000/svg"
            p-id="5358"
            width="32"
            height="32"
          >
            <path
              d="M921.856 987.008c-13.80352 0-26.7264-5.31456-36.37248-14.96064L512 598.56384l-373.48352 373.48352c-9.64608 9.64608-22.56384 14.96064-36.37248 14.96064s-26.7264-5.31456-36.37248-14.96064l-2.048-2.048c-9.64608-9.64608-14.95552-22.55872-14.95552-36.37248 0-13.80352 5.31456-26.7264 14.95552-36.37248L437.21216 523.776 63.72352 150.29248c-9.88672-9.6256-15.33952-22.54848-15.33952-36.37248s5.4528-26.74688 15.36512-36.39296l2.02752-2.02752c9.64608-9.64608 22.55872-14.95552 36.37248-14.95552 13.80864 0 26.7264 5.31456 36.37248 14.96064L512 449.49504l373.48352-373.99552c9.64608-9.64608 22.56384-14.96064 36.37248-14.96064s26.7264 5.31456 36.37248 14.96064l2.048 2.04288c20.05504 20.05504 20.05504 52.68992 0 72.74496L586.78784 523.776l373.48352 373.48352c9.64608 9.64608 14.96064 22.56384 14.96064 36.37248s-5.31456 26.7264-14.96064 36.37248l-2.048 2.048c-9.64096 9.64096-22.56384 14.95552-36.36736 14.95552z"
              p-id="5359"
              fill="#3EAF7C"
            />
            <path
              d="M921.856 63.104c12.544 0 25.088 4.736 34.56 14.208l2.048 2.048c18.944 18.944 18.944 50.176 0 69.12l-375.296 375.296 375.296 375.296c18.944 18.944 18.944 50.176 0 69.12l-2.048 2.048c-9.472 9.472-22.016 14.208-34.56 14.208s-25.088-4.736-34.56-14.208L512 594.944l-375.296 375.296c-9.472 9.472-22.016 14.208-34.56 14.208s-25.088-4.736-34.56-14.208l-2.048-2.048c-18.944-18.944-18.944-50.176 0-69.12l375.296-375.296L65.536 148.48c-19.456-18.944-19.456-50.176 0-69.12l2.048-2.048c9.472-9.472 22.016-14.208 34.56-14.208s25.088 4.736 34.56 14.208L512 453.12l375.296-375.808c9.472-9.472 22.016-14.208 34.56-14.208m0-5.12c-14.4896 0-28.05248 5.5808-38.17984 15.70816L512 445.8752 140.32896 73.69216c-10.13248-10.13248-23.69024-15.70816-38.18496-15.70816s-28.05248 5.5808-38.17984 15.70816l-2.048 2.048A52.91008 52.91008 0 0 0 45.824 113.92c0 14.5152 5.7344 28.09344 16.13824 38.22592L433.59232 523.776l-371.67616 371.67616c-10.12736 10.12736-15.70816 23.69024-15.70816 38.17984s5.5808 28.05248 15.70816 38.17984l2.048 2.048c10.12736 10.12736 23.69024 15.70816 38.17984 15.70816s28.05248-5.5808 38.17984-15.70816L512 602.18368l371.67616 371.67616c10.12736 10.12736 23.69024 15.70816 38.17984 15.70816s28.05248-5.5808 38.17984-15.70816l2.048-2.048c10.12736-10.12736 15.70816-23.69024 15.70816-38.17984s-5.5808-28.05248-15.70816-38.17984L590.40768 523.776l371.67616-371.67616c21.05344-21.05344 21.05344-55.30624 0-76.35968l-2.048-2.048c-10.12736-10.12736-23.69024-15.70816-38.17984-15.70816z"
              p-id="5360"
              fill="#3EAF7C"
            />
          </svg>
        </div>
      </div>
      <div class="notification-content">
        <h5>{{contentInfo.title}}</h5>
        <img :src="contentInfo.imgUrl" alt="展示图" v-if="contentInfo.needImg" />
        <div v-else class="content" :style="contentInfo.contentStyle">{{contentInfo.content}}</div>
      </div>
      <div style="padding: 0px 16px;">
        <hr />
        <a :href="bottomInfo.linkTo" class="btn-donate">{{bottomInfo.btnText}}</a>
      </div>
    </div>
  </transition>
</template>  

<script>
export default {
  name: "DisplayWindow",
  data() {
    return {
      duration: "0.35",
      delay: "0",
      showWindow: false,
      windowStyle: WINDOW_STYLE,
      contentInfo: CONTENT_INFO,
      bottomInfo: BOTTOM_INFO,
      title: TITLE,
      delayMount: DELAYMOUNT,
      closeOnce: CLOSEONCE,
      hideRouteList: HIDEROUTELIST
    };
  },
  mounted() {
    this.checkPath();
    sessionStorage.setItem("AlreadyInit", true);
  },
  methods: {
    closeWindow() {
      if (this.closeOnce) {
        sessionStorage.setItem("closeOnce", true);
      }
      this.showWindow = false;
    },
    setStyle(items) {
      items.style.transition = `all ${this.duration}s ease-in-out ${this.delay}s`;
      items.style.opacity = 0;
    },
    unsetStyle(items) {
      items.style.opacity = 1;
    },
    checkPath() {
      if (sessionStorage.getItem("AlreadyInit")) {
        this.delayMount = 0;
      }
      if (this.hideRouteList.indexOf(this.$route.path.split("/")[1]) >= 0) {
        this.showWindow = false;
      } else {
        if (!sessionStorage.getItem("closeOnce")) {
          setTimeout(() => {
            this.showWindow = true;
          }, this.delayMount);
        }
      }
    }
  },
  watch: {
    $route(to, from) {
      this.checkPath();
    }
  }
};
</script>

<style scoped>
.showWindow {
  position: fixed;
  z-index: 19;
  width: 260px;
  right: 20px;
  top: 70px;
  background: #fff;
  border: 1px solid #3eaf7c;
  border-radius: 0.5rem;
  background: var(--background-color);
  box-shadow: var(--box-shadow);
}
.top {
  background: #3eaf7c;
  display: -webkit-flex;
  display: flex;
  flex-flow: row wrap;
  justify-content: space-between;
  align-content: center;
  box-sizing: border-box;
  padding: 10px;
}
.notice > span {
  vertical-align: middle;
  color: #fff;
  line-height: 20px;
}

.notice > svg {
  width: 16px;
  height: 16px;
  vertical-align: middle;
  line-height: 20px;
}

.close {
  vertical-align: middle;
  width: 20px;
  height: 20px;
  background: #fff;
  display: -webkit-flex;
  display: flex;
  flex-flow: row wrap;
  justify-content: center;
  align-content: center;
  border-radius: 50%;
}

.close > svg {
  width: 13px;
  height: 13px;
}

.notification-content {
  box-sizing: border-box;
  padding: 10px 15px 0;
}

.notification-content h5 {
  margin: 0.2rem 0;
  text-align: center;
}

.notification-content img {
  width: 100%;
}

.btn-donate {
  display: block;
  margin: 2rem auto;
  width: 3.4rem;
  line-height: 3.4rem;
  text-align: center;
  background-color: #3eaf7c;
  border-radius: 50%;
  color: #fff;
  font-size: 1rem;
  box-shadow: var(--box-shadow);
  cursor: pointer;
}
</style>

